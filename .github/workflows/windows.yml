name: Build Windows EXE

on:
    push:
        branches: [master]
    pull_request:

jobs:
    build-windows:
        runs-on: windows-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Install MSYS2 + GTK4
              uses: msys2/setup-msys2@v2
              with:
                  update: true
                  install: >
                      mingw-w64-x86_64-toolchain
                      mingw-w64-x86_64-gtk4
                      mingw-w64-x86_64-pkg-config

            - name: Add MSYS2 to PATH
              shell: bash
              run: |
                  echo "C:/msys64/mingw64/bin" >> $GITHUB_PATH

            - name: Build (release)
              shell: bash
              run: |
                  cargo build --release --target x86_64-pc-windows-gnu

            - name: Upload EXE
              uses: actions/upload-artifact@v4
              with:
                  name: windows-exe
                  path: target/x86_64-pc-windows-gnu/release/*.exe
